<?xml version="1.0" ?><simulation xmds-version="2">
  <name>bec_transport</name>
  <author>Jamie Feiss</author>
  <description>
    BEC transport test
  </description>

  <features>
      <benchmark/>
      <bing/>
      <fftw plan="patient"/>
      <auto_vectorise/>
      <validation kind="run-time"/>
      <globals>
          <![CDATA[
                    const real T = 3.0; // End time
            const real x_0 = 3.0; // Final position
          ]]>
       </globals>
     </features>

  <!-- Number of trajectories (single processor) -->
  <driver name="multi-path" paths="10"/>

    <!-- Define dimensions -->
    <geometry>
        <propagation_dimension>t</propagation_dimension>
        <transverse_dimensions>
        <dimension domain="(-10, 10)" lattice="64" name="x"/>
        </transverse_dimensions>
    </geometry>

  <!-- Initialisation wavefunction -->
  <vector dimensions="x" name="wavefunction" type="complex">
    <components>psi</components>
    <initialisation>
      <![CDATA[
        psi = 1.0 / pow(M_PI, 0.25) * exp(-pow(x, 2) / 2.0); // ground state of HO
      ]]>
    </initialisation>
  </vector>

  <!-- Timing function -->
  <computed_vector dimensions="" name="timing_function" type="real">
    <components>lambda</components>
    <evaluation>
      <![CDATA[
        lambda = t / T;
      ]]>
    </evaluation>
  </computed_vector>

  <!-- Harmonic trap potential -->
  <vector dimensions="x" name="potential" type="real">
    <components>V</components>
    <initialisation>
                <dependencies>timing_function</dependencies>
      <![CDATA[
        V = pow(x - lambda * x, 2) / 2.0;
      ]]>
    </initialisation>
  </vector>

  <sequence>
    <!-- Imaginary time to find ground state -->
    <integrate algorithm="RK4" interval="5.0e-3" steps="10000">
      <samples>0</samples>
      <operators>
        <integration_vectors>wavefunction</integration_vectors>
        <dependencies>potential</dependencies>
        <operator constant="yes" kind="ip" type="real">
          <operator_names>Ltt</operator_names>
          <![CDATA[
            Ltt = -pow(kx, 2) / 2.0;
          ]]>
        </operator>
        <![CDATA[
          dpsi_dt = Ltt[psi] - (V + mod2(psi)) * psi;
        ]]>
      </operators>
    </integrate>
        
        <!-- GPE -->
        <integrate algorithm="ARK45" interval="T" tolerance="1e-8">
          <samples>100</samples>
          <operators>
            <integration_vectors>wavefunction</integration_vectors>
            <dependencies>potential</dependencies>
            <operator constant="yes" kind="ip" type="imaginary">
              <operator_names>Ltt</operator_names>
              <![CDATA[
                Ltt = -i * pow(kx, 2) / 2.0;
              ]]>
            </operator>
            <![CDATA[
              dpsi_dt = Ltt[psi] - i * (V + mod2(psi)) * psi;
            ]]>
          </operators>
        </integrate>
</sequence>

  <output>
      <sampling_group basis="x" initial_sample="no">
        <moments>psi_real psi_imag density </moments>
        <dependencies>wavefunction</dependencies>
        <![CDATA[
          psi_real = psi.Re();
          psi_imag = psi.Im();
          density = mod2(psi);
        ]]>
      </sampling_group>
  </output>

<info>
Script compiled with XMDS2 version 2.2.3 "It came from the deep" (Debian package 2.2.3+dfsg-5)
See http://www.xmds.org for more information.
</info>

<XSIL Name="moment_group_1">
  <Param Name="n_independent">2</Param>
  <Array Name="variables" Type="Text">
    <Dim>8</Dim>
    <Stream><Metalink Format="Text" Delimiter=" \n"/>
t x mean_psi_real mean_psi_imag mean_density stderr_psi_real stderr_psi_imag stderr_density 
    </Stream>
  </Array>
  <Array Name="data" Type="double">
    <Dim>100</Dim>
    <Dim>64</Dim>
    <Dim>8</Dim>
    <Stream><Metalink Format="HDF5" Type="Remote" Group="/1"/>
bec_transport.h5
    </Stream>
  </Array>
</XSIL>
</simulation>
